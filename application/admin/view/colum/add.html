<!DOCTYPE html>
<html class="x-admin-sm">

  <head>
    {include file="public/head" /}
  </head>
  <body>
    <style>
      /*layui-unselect layui-form-select*/
      .layui-unselect.layui-form-select {
        /*width: 41%;*/
        width: 190px;
      }
    </style>
    <div class="layui-fluid">
      <div class="layui-row">
        <form class="layui-form" id="addForm" onsubmit="return false">
          <input id='editid' type="hidden" name="id"></inout>
          <div class="layui-form-item">
            <label for="username" class="layui-form-label">
              <span class="x-red">*</span>栏目名称
            </label>
            <div class="layui-input-inline">
              <input type="text" id="name" name="name" lay-verify="required"
                autocomplete="off" class="layui-input"">
            </div>
            <!-- <div class="layui-form-mid layui-word-aux">
              <span class="x-red">*</span>将会成为您唯一的登入名
            </div> -->
          </div>
          <div class="layui-form-item">
            <label class="layui-form-label"><span class="x-red">*</span>上级栏目</label>
            <div class="layui-input-block">
              <select name="pid" lay-verify="required">
                <option value="0">顶级栏目</option>
                {volist name="data" id="dat"}
                 <!-- str_repeat()重复的意思 -->
                <option value="{$dat.id}">|---<?php echo str_repeat('-',$dat['level']); ?>{$dat.name}</option>
                {/volist}
              </select>
            </div>
          </div>
          
          <div class="layui-form-item">
            <label for="L_repass" class="layui-form-label">
            </label>
            <button class="layui-btn" lay-filter="add" lay-submit="">
              提交
            </button>
          </div>
        </form>
      </div>
    </div>
    <script>
      layui.use(['form', 'layer'],
        function() {
          $ = layui.jquery;
          var form = layui.form,
            layer = layui.layer;

          //自定义验证规则
          // form.verify({
          //   nikename: function(value) {
          //     if (value.length < 5) {
          //       return '昵称至少得5个字符啊';
          //     }
          //   },
          //   pass: [/(.+){6,12}$/, '密码必须6到12位'],
          //   repass: function(value) {
          //     if ($('#L_pass').val() != $('#L_repass').val()) {
          //       return '两次密码不一致';
          //     }
          //   }
          // });

          //监听提交
          form.on('submit(add)',
            function(data) {
              str = $('#addForm').serialize();  //获取序列化的数据
              // id = $('#editid').val();
              $.post("{:url('add')}",{str:str},function(data){
                  if (data==1) {
                      layer.alert("添加成功", {
                          icon: 6
                      },
                      function() {
                          // 获得frame索引
                          var index = parent.layer.getFrameIndex(window.name);
                          //关闭当前frame
                          parent.layer.close(index);
                          parent.location.reload();
                      });
                  }else {
                      layer.alert(data.error);
                  }
              })


              // console.log(data);
              // //发异步，把数据提交给php
              // layer.alert("增加成功", {
              //     icon: 6
              //   },
              //   function() {
              //     //关闭当前frame
              //     xadmin.close();

              //     // 可以对父窗口进行刷新 
              //     xadmin.father_reload();
              //   });
              // return false;
            });

        });
    </script>
  </body>

</html>